Общие замечания
===============

1. В качестве БД был выбран PostgreSQL. Схема БД создавалась вручную. Подключение к БД осуществлялось через файл конфигурации **pg_service.conf**, который может быть скопирован в **~/.pg_service.conf** пользователя или указан в переменной окружения 'PGSERVICEFILE'. Имя сервиса 'IT1'.


2. Необходимое ПО:
- perlbrew - не обязательно;

- Mojolicious, устанавливается командой
```
$ curl -L https://cpanmin.us | perl - -M https://cpan.metacpan.org -n Mojolicious
```

- DBI, DBD::Pg - модули работы с БД

Скрипт загрузки load-mainlog.pl
================================

Скрипт загрузки **load-mainlog.pl** берет данные из входного потока или из списка файлов, перечисленных как аргументы командной строки. В любом случае, скрипт рассматривает данные как сплошной поток.

Перед сохранением первой разобранной записи входного лога, происходит коннект к БД и очистка таблиц **message** и **log**.

В случае ошибок при открытии БД или при сохранении записи, разбор записей продолжается без попытки их сохранения в БД и по завершении разбора производится откат транзакции. Для записей, во время сохранения которых произошли ошибки БД, выводится диагностическое сообщение, номер записи в потоке и сама запись.

По окончании работы, скрипт выдает некоторую статистическую информацию. Например, для использованного в качестве примера лога:
```
$ perl load-mainlog.pl test-data/out
Lines read            10000
Records parsed        7057
Wrong records count   0
Records with w/o id   0
Unique emails count   648
Unique chains count   2394
Max chain count       11
Flags counts:
  '**' : 291
  '->' : 226
  '<=' : 1561
  '==' : 3069
  '=>' : 1910
Emails:
  aaqvjvgq@vinsk.nov.su	 => {'==' : 1}
  absmqd@tech-success.ru	 => {'==' : 2, '=>' : 2}
  . . .
  zzgjjl@mail.ru	 => {'==' : 2, '=>' : 2}
  zzlwpvr@gmail.com	 => {'==' : 1, '=>' : 1}
```


HTML-страница с поисковой формой
=================================

HTML-страница с поисковой формой генерируется автоматически путем запуска небольшого приложения Mojolicious
```
$ morbo server.pl
Web application available at http://127.0.0.1:3000
```
и переходом в браузере по указанному адресу (см. сохраненный **Request.html**).

В поле ввода *Email* набирается адрес вида *foo@bar.dom* и нажимается кнопка *Искать*.

Пример выдачи для адресов *yomlvprst@yandex.ru* и *xmdnwgppabwp@gmail.com* в файлах
**Response_yomlvprst_at_yandex.ru.html** и **Response_xmdnwgppabwp_at_gmail.com.html** соответственно.

**Замечания:**

- введенный почтовый адрес для поиска не верифицируется, а рассматривается просто как текст.

- поскольку в задании говорилось только об отображении не более 100 первых записей и выдаче сообщения об отброшенных данных, то для ограничения числа выходных записей была использована конструкция SQL **LIMIT 101**. При получении 101 записи последняя отбрасывается и выдается соответствующее сообщение.

- при возникновении ошибок с БД, происходит переход на страничку с сообщением об ошибке.
